<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Beer Pong</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="shortcut icon" href="/app/favicon.ico" />

        <link href='http://fonts.googleapis.com/css?family=Permanent+Marker' rel='stylesheet' type='text/css'>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/beer-pong.css" rel="stylesheet">

        <script src="https://cdn.firebase.com/v0/firebase.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="https://swww.tokbox.com/webrtc/v2.0/js/TB.min.js"></script>

        <script type="text/javascript">
        // Initialize API key, session, and token...
        // Think of a session as a room, and a token as the key to get in to the room
        // Sessions and tokens are generated on your server and passed down to the client
        var apiKey = "44627232";
        var sessionId = "1_MX40NDYyNzIzMn5-U2F0IEphbiAyNSAyMTo1MTo1MyBQU1QgMjAxNH4wLjk0MjAxNDkzfg";
        var token = "T1==cGFydG5lcl9pZD00NDYyNzIzMiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1mMTVmYTNjYzAzZjAwYzY4ZDg2NmQwZmNmZDZmMTQ3NThhODBlOTkwOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDQwTkRZeU56SXpNbjUtVTJGMElFcGhiaUF5TlNBeU1UbzFNVG8xTXlCUVUxUWdNakF4Tkg0d0xqazBNakF4TkRremZnJmNyZWF0ZV90aW1lPTEzOTA3MTU1MTMmbm9uY2U9MC4zOTc1NDE2MjYyNzE3MDA0JmV4cGlyZV90aW1lPTEzOTA4MDE5MTMmY29ubmVjdGlvbl9kYXRhPQ==";

        // Initialize session, set up event listeners, and connect
        function sessionConnectedHandler(event) {
            var div = document.createElement('div');
            div.id = "opentok_publisher";

            var publisherContainer = document.getElementById('publisherContainer');
            publisherContainer.appendChild(div);

            var publisher = TB.initPublisher(apiKey, div.id, {width: 300, height: 225});
            session.publish(publisher);

            subscribeToStreams(event.streams);
        }

        function subscribeToStreams(streams) {
            for (var i = 0; i < streams.length; i++) {
                var stream = streams[i];
                if (stream.connection.connectionId != session.connection.connectionId) {
                    var div = document.createElement('div');
                    div.id = "opentok_subscriber_" + stream.streamId;

                    var subscriberContainer = document.getElementById('subscriberContainer');
                    subscriberContainer.appendChild(div);

                    session.subscribe(stream, div.id, {width: 300, height: 225});
                }
            }
        }

        function streamCreatedHandler(event) {
            subscribeToStreams(event.streams);
        }


        var session  = TB.initSession(sessionId);
        session.connect(apiKey, token);
        session.addEventListener("sessionConnected",
                                 sessionConnectedHandler);
        session.addEventListener("streamCreated",
                                 streamCreatedHandler);
        </script>
    </head>
    <body>

        <div class="container">
            <h1>BEER PONG</h1>

            <div id="stuff">
                <div class="controls">
                    <input type="button" class="btn btn-danger" id="restartButton" value="New Game" onClick="restartGame()">
                    <h3 id="status"></h3>
                </div>
                <div id="aiming">
                    <input type='number' id='xCoordinate' placeholder='X-Coordinate'>
                    <input type='number' id='theta' placeholder='Degrees'>
                    <input type='number' id='power' placeholder='Power'>
                </div>
            </div>


            <div class="table">
                <div id="opponent" class="player">
                    <div class="row">
                        <div class="cup-9"></div>
                        <div class="cup-8"></div>
                        <div class="cup-7"></div>
                        <div class="cup-6"></div>
                    </div>
                    <div class="row">
                        <div class="cup-5"></div>
                        <div class="cup-4"></div>
                        <div class="cup-3"></div>
                    </div>
                    <div class="row">
                        <div class="cup-2"></div>
                        <div class="cup-1"></div>
                    </div>
                    <div class="row">
                        <div class="cup-0"></div>
                    </div>
                </div>
                <div id="me" class="player">
                    <div class="row">
                        <div class="cup-0"></div>
                    </div>
                    <div class="row">
                        <div class="cup-1"></div>
                        <div class="cup-2"></div>
                    </div>
                    <div class="row">
                        <div class="cup-3"></div>
                        <div class="cup-4"></div>
                        <div class="cup-5"></div>
                    </div>
                    <div class="row">
                        <div class="cup-6"></div>
                        <div class="cup-7"></div>
                        <div class="cup-8"></div>
                        <div class="cup-9"></div>
                    </div>
                </div>
            </div>

        </div>

        <div id="publisherVideoSection">
            <div id="publisherContainer"></div>
            <h3 id="playerName" class="videoSubtitle"></h3>
        </div>

        <div id="subscriberVideoSection">
            <div id="subscriberContainer"></div>
            <h3 class="videoSubtitle">Your Challenger</h3>
        </div>

        <script type="text/javascript" src="js/beer-pong.js"></script>
    </body>
</html>
